[[ $- == *i* ]] || return 0
_dircmd_hook()
{
  local previous_exit_status=$?
  if [[ -n "${DIRCMD_PATH}" ]]; then
    if ! echo "${PWD}" | egrep -q "^${DIRCMD_PATH}" ; then
      if [[ -e ${DIRCMD_PATH}/.dircmd/exit ]]; then
        source ${DIRCMD_PATH}/.dircmd/exit
        unset DIRCMD_PATH
      fi
    fi
  fi
  if [[ -z "${DIRCMD_PATH}" ]]; then
    if [[ "${PWD}" != "${OLDPWD}" ]]; then
      if echo "${PWD}/" | egrep -q "^${OLDPWD}" ; then
        DIR="$(dirname ${PWD})"
        while [[ "${DIR}" != "${OLDPWD}" ]]; do
          if [[ -e ${DIR}/.dircmd/entry ]]; then
            BACK="${PWD}"
            cd ${DIR}
            source .dircmd/entry
            export DIRCMD_PATH="${PWD}"
            cd ${BACK}
            break
          else
            DIR="$(dirname ${DIR})"
          fi
        done
      fi
    fi
  fi
  if [[ -z "${DIRCMD_PATH}" ]]; then
    if [[ -e ${PWD}/.dircmd/entry ]]; then
      source ${PWD}/.dircmd/entry
      export DIRCMD_PATH="${PWD}"
    fi
  fi
  return $previous_exit_status
}
if ! [[ "${PROMPT_COMMAND}" =~ _dircmd_hook ]]; then
  PROMPT_COMMAND="_dircmd_hook;${PROMPT_COMMAND}"
fi

